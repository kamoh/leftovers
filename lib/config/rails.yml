---
excludes:
  - db/migrate/*

allowed:
  - suffix: Helper # included in the ViewContext
  - ClassMethods # ActiveSupport::Concern
  - process_action # ActiveSupport::LogSubscriber
  - validate_each # ActiveModel::EachValidator
  - format_message # ActiveSupport::Logger
  - ssl_configured? # ApplicationController

rules:
  - method:
      - after_initialize
      - after_find
      - after_touch
      - before_validation
      - after_validation
      - before_save
      - around_save
      - after_save
      - before_create
      - around_create
      - after_create
      - before_update
      - around_update
      - after_update
      - before_destroy
      - around_destroy
      - after_destroy
      - after_commit
      - after_rollback
      - after_create_commit
      - after_update_commit
      - after_destroy_commit
      - after_save_commit
      - validate
      - with_options
    caller:
      - position: 1
      - keyword:
          - if
          - unless
  - method:
      - after_action
      - append_after_action
      - append_around_action
      - append_before_action
      - around_action
      - before_action
      - prepend_after_action
      - prepend_around_action
      - prepend_before_action
      - skip_before_action
      - skip_after_action
      - skip_around_action
    caller:
      - position: '*'
      - keyword:
          - if
          - unless
  - method:
      - delete
      - get
      - patch
      - post
      - put
    caller:
      - position: 1
  - method: validates
    caller:
      - position: '*'
      - keyword:
          - 'in'
          - inclusion
          - scope
      - key: true
        suffix: Validator
        activesupport: camelize
      - keyword:
          - if
          - unless
  - method:
      - validate
      - validate_associated
    caller:
      - position: '*'
      - keyword: [if, unless]
  - method:
    - check_box
    - date_select
    - datetime_select
    - file_field
    - hidden_field
    - label
    - radio_button
    - select
    - time_select
    - time_zone_select
    - color_field
    - date_field
    - datetime_field
    - dattime_local_field
    - email_field
    - month_field
    - number_field
    - password_field
    - phone_field
    - range_field
    - search_field
    - telephone_field
    - text_area
    - text_field
    - time_field
    - url_field
    - week_field
    caller:
      position: 1 # with a receiver
      position: 2 # with no receiver
  - method: fields_for
    caller:
      position: 1
      suffix: _attributes
  - method: options_from_collection_for_select
    caller:
      - position: [2,3]
  - method:
      - collection_select
      - collection_check_boxes
      - collection_radio_buttons
    caller:
      - position: 2
        suffix: '='
      - position: [4,5]
  - method: grouped_collection_select
    caller:
      - position: 2
        suffix: '='
      - position: [4,5,6,7]
  - method: option_groups_from_collection_for_select
    caller:
      - position: [1,2,3,4]
  - method: scope
    path: app/models/*
    definer:
      position: 1 # ar
  - method: scope
    path: config/routes*
    caller:
      keyword: module # routes
      activesupport: camelize
  - method: namespace
    caller:
      - position: 1
        activesupport: camelize
  - method: attribute
    path: app/models/*
    definer:
      - position: 1
        transforms:
          - true
          - suffix: '?'
          - suffix: '='
  - method:
    - has_one
    - belongs_to
    caller:
      position: 1
      activesupport: camelize
      unless:
        keyword: class_name
  - method:
    - has_many
    - has_and_belongs_to_many
    caller:
      position: 1
      activesupport: [singularize, camelize]
      unless:
        keyword: class_name
  - method:
    - has_many
    - has_one
    - has_and_belongs_to_many
    caller:
      keyword: as
  - method:
      - has_one
      - has_many
      - belongs_to
      - has_and_belongs_to_many
    definer:
      - position: 1
        transforms:
          - true
          - suffix: '='
    caller:
      - keyword: through
      - keyword: class_name
      - keyword: inverse_of
  - method:
      - rescue_from
    caller:
      - keyword: with
  - method:
      - match
      - delete
      - get
      - patch
      - post
      - put
    caller:
      - position: 1
      - keyword: '*'
        after: '#'
      - keyword: '*'
        before: '#'
        suffix: Controller
        activesupport: camelize
      - keyword: action
  - method: delegate
    definer:
      - position: '*'
        if:
          keyword:
            prefix: true
        prefix:
          from_keyword: to
          joiner: '_'
      - position: '*'
        if:
          keyword: prefix
        unless:
          keyword:
            prefix: true
        prefix:
          from_keyword: prefix
          joiner: '_'
    caller:
      - keyword: to
      - position: '*'
        if:
          keyword: prefix
  - method:
      - resource
      - resources
    caller:
      - keyword: only
      - keyword: controller
        suffix: Controller
        activesupport: camelize
  - method:
      - resources
      - controller
      - namespace
    caller:
      - position: 1
        suffix: Controller
        activesupport: camelize
  - method: accepts_nested_attributes_for
    definer:
      position: 1
      transforms:
        - suffix: _attributes
        - suffix: _attributes=
    caller:
      keyword: reject_if
  - method: resource
    caller:
      - position: 1
        suffix: Controller
        activesupport:
          - pluralize
          - camelize
  - method:
    - new
    - create
    - create!
    - update
    - update!
    - assign_attributes
    caller:
      key: true
      suffix: '='
  - method: permit
    caller:
      position: '*'
      keyword: '*'
      key: true
      suffix: "="
  - method: layout
    caller:
      position: 1
  - method:
      - includes
      - preload
      - eager_load
      - joins
      - left_joins
      - left_outer_joins
    caller:
      position: '*'
      keyword: '*'
      key: true

